import{C as z,J as O,c as r,a as l,t as o,y as a,K as u,L as V,M,F as k,E as x,N as p,O as q,G,r as c,o as i,H as j,n as C}from"./BEFdwPCg.js";import{T as U}from"./CGQrFPvo.js";import{u as H}from"./DPGkDMz_.js";import"./BMadXahP.js";const J={class:"flex justify-between items-center mb-6"},Q={class:"grid grid-cols-4 gap-4 mb-6"},W={class:"stat-card"},X={class:"stat-value"},Y={class:"stat-card"},Z={class:"stat-value"},ll={class:"stat-card"},tl={class:"stat-value"},sl={class:"stat-card"},el={class:"stat-value"},al={class:"card p-4 mb-6"},nl={class:"flex gap-4"},ol=["value"],ul={class:"card overflow-hidden"},dl={class:"table"},rl={key:0},il={class:"font-medium text-slate-100"},pl={class:"text-sm text-slate-400"},cl={key:1,class:"text-slate-500"},bl={class:"text-sm text-slate-400"},_l=["onClick"],gl={key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},vl={class:"bg-slate-800 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-slate-700"},yl={class:"text-xl font-bold text-slate-100 mb-4"},fl={class:"grid grid-cols-2 gap-4"},ml=["value"],kl=["value"],xl={class:"flex justify-end gap-2 pt-4"},Cl={type:"submit",class:"btn btn-primary"},Ll=z({__name:"index",setup(wl){const y=H(),_=c([]),S=c([]),F=c(!1),w=c(!1),b=c(null),g=c(""),v=c(""),L={product_id:null,status_id:1,buy_price:0,buy_shipping_cost:0,sell_price:null,sell_packaging_cost:0,sell_postage_cost:0,sell_shipping_collected:0,storage:null,source_link:"",buy_date:"",sell_date:""},n=c({...L}),A=C(()=>_.value.filter(e=>e.status_id===3).length),I=C(()=>_.value.filter(e=>e.status_id===4).length),R=C(()=>_.value.filter(e=>e.status_id===5).length),E=C(()=>_.value.filter(e=>{if(g.value&&e.status_id!==parseInt(g.value))return!1;if(v.value){const t=v.value.toLowerCase(),s=e.product?.name?.toLowerCase()||"",d=e.product?.brand?.toLowerCase()||"";if(!s.includes(t)&&!d.includes(t))return!1}return!0})),T=async()=>{F.value=!0;try{const[e,t]=await Promise.all([y.get("/inventory"),y.get("/products")]);_.value=e,S.value=t}catch(e){console.error("Failed to fetch data:",e)}finally{F.value=!1}},K=e=>{b.value=e,n.value={product_id:e.product_id,status_id:e.status_id,buy_price:e.buy_price,buy_shipping_cost:e.buy_shipping_cost,sell_price:e.sell_price||null,sell_packaging_cost:e.sell_packaging_cost||0,sell_postage_cost:e.sell_postage_cost||0,sell_shipping_collected:e.sell_shipping_collected||0,storage:e.storage,source_link:e.source_link,buy_date:e.buy_date?e.buy_date.split("T")[0]:"",sell_date:e.sell_date?e.sell_date.split("T")[0]:""}},D=()=>{w.value=!1,b.value=null,n.value={...L}},$=async()=>{try{b.value?await y.put(`/inventory/${b.value.id}`,n.value):await y.post("/inventory",n.value),D(),await T()}catch(e){console.error("Failed to save item:",e)}},f=e=>`${(e/100).toFixed(2)} kr`,B=e=>new Date(e).toLocaleDateString("sv-SE"),N=e=>{const t=(e.sell_price||0)+(e.sell_shipping_collected||0),s=e.buy_price+e.buy_shipping_cost,d=(e.sell_packaging_cost||0)+(e.sell_postage_cost||0),m=t-(s+d);return m>=0?`+${f(m)}`:f(m)},P=e=>{const t=(e.sell_price||0)+(e.sell_shipping_collected||0),s=e.buy_price+e.buy_shipping_cost,d=(e.sell_packaging_cost||0)+(e.sell_postage_cost||0);return t-(s+d)>=0?"text-emerald-400":"text-red-400"},h=e=>{const t={1:"badge badge-info",2:"badge badge-info",3:"badge badge-warning",4:"badge badge-info",5:"badge badge-success"};return t[e]||t[1]};return O(T),(e,t)=>(i(),r("div",null,[l("div",J,[t[15]||(t[15]=l("h1",{class:"page-header"},"Lager",-1)),l("button",{onClick:t[0]||(t[0]=s=>w.value=!0),class:"btn btn-primary"}," Lägg till ")]),l("div",Q,[l("div",W,[t[16]||(t[16]=l("p",{class:"stat-label"},"Totalt antal",-1)),l("p",X,o(a(_).length),1)]),l("div",Y,[t[17]||(t[17]=l("p",{class:"stat-label"},"I lager",-1)),l("p",Z,o(a(A)),1)]),l("div",ll,[t[18]||(t[18]=l("p",{class:"stat-label"},"Utlagda",-1)),l("p",tl,o(a(I)),1)]),l("div",sl,[t[19]||(t[19]=l("p",{class:"stat-label"},"Sålda",-1)),l("p",el,o(a(R)),1)])]),l("div",al,[l("div",nl,[u(l("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>M(g)?g.value=s:null),class:"input w-48"},[t[20]||(t[20]=l("option",{value:""},"Alla statusar",-1)),(i(!0),r(k,null,x(a(U),(s,d)=>(i(),r("option",{key:d,value:d},o(s),9,ol))),128))],512),[[V,a(g)]]),u(l("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>M(v)?v.value=s:null),type:"text",class:"input flex-1",placeholder:"Sök..."},null,512),[[p,a(v)]])])]),l("div",ul,[l("table",dl,[t[21]||(t[21]=l("thead",null,[l("tr",null,[l("th",null,"Produkt"),l("th",null,"Status"),l("th",null,"Köpris"),l("th",null,"Försäljningspris"),l("th",null,"Vinst"),l("th",null,"Datum"),l("th")])],-1)),l("tbody",null,[(i(!0),r(k,null,x(a(E),s=>(i(),r("tr",{key:s.id},[l("td",null,[s.product?(i(),r("div",rl,[l("p",il,o(s.product.brand)+" "+o(s.product.name),1),l("p",pl,o(s.product.category),1)])):(i(),r("span",cl,"Okänd"))]),l("td",null,[l("span",{class:j(h(s.status_id))},o(a(U)[s.status_id]||"okänd"),3)]),l("td",null,o(f(s.buy_price)),1),l("td",null,o(s.sell_price?f(s.sell_price):"-"),1),l("td",{class:j(P(s))},o(N(s)),3),l("td",bl,o(B(s.created_at)),1),l("td",null,[l("button",{onClick:d=>K(s),class:"text-primary-400 hover:text-primary-300"}," Redigera ",8,_l)])]))),128))])])]),a(w)||a(b)?(i(),r("div",gl,[l("div",vl,[l("h2",yl,o(a(b)?"Redigera":"Lägg till ny"),1),l("form",{onSubmit:q($,["prevent"]),class:"space-y-4"},[l("div",fl,[l("div",null,[t[23]||(t[23]=l("label",{class:"label"},"Produkt",-1)),u(l("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a(n).product_id=s),class:"input"},[t[22]||(t[22]=l("option",{value:""},"Välj produkt...",-1)),(i(!0),r(k,null,x(a(S),s=>(i(),r("option",{key:s.id,value:s.id},o(s.brand)+" "+o(s.name),9,ml))),128))],512),[[V,a(n).product_id]])]),l("div",null,[t[24]||(t[24]=l("label",{class:"label"},"Status",-1)),u(l("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a(n).status_id=s),class:"input"},[(i(!0),r(k,null,x(a(U),(s,d)=>(i(),r("option",{key:d,value:d},o(s),9,kl))),128))],512),[[V,a(n).status_id]])]),l("div",null,[t[25]||(t[25]=l("label",{class:"label"},"Köpris (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a(n).buy_price=s),type:"number",class:"input"},null,512),[[p,a(n).buy_price,void 0,{number:!0}]])]),l("div",null,[t[26]||(t[26]=l("label",{class:"label"},"Köpfrit (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a(n).buy_shipping_cost=s),type:"number",class:"input"},null,512),[[p,a(n).buy_shipping_cost,void 0,{number:!0}]])]),l("div",null,[t[27]||(t[27]=l("label",{class:"label"},"Försäljningspris (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a(n).sell_price=s),type:"number",class:"input"},null,512),[[p,a(n).sell_price,void 0,{number:!0}]])]),l("div",null,[t[28]||(t[28]=l("label",{class:"label"},"Förpackning (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>a(n).sell_packaging_cost=s),type:"number",class:"input"},null,512),[[p,a(n).sell_packaging_cost,void 0,{number:!0}]])]),l("div",null,[t[29]||(t[29]=l("label",{class:"label"},"Frakt (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a(n).sell_postage_cost=s),type:"number",class:"input"},null,512),[[p,a(n).sell_postage_cost,void 0,{number:!0}]])]),l("div",null,[t[30]||(t[30]=l("label",{class:"label"},"Frakt mottaget (öre)",-1)),u(l("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a(n).sell_shipping_collected=s),type:"number",class:"input"},null,512),[[p,a(n).sell_shipping_collected,void 0,{number:!0}]])]),l("div",null,[t[31]||(t[31]=l("label",{class:"label"},"Lagerplats",-1)),u(l("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>a(n).storage=s),type:"number",class:"input"},null,512),[[p,a(n).storage,void 0,{number:!0}]])]),l("div",null,[t[32]||(t[32]=l("label",{class:"label"},"Länk",-1)),u(l("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>a(n).source_link=s),type:"text",class:"input"},null,512),[[p,a(n).source_link]])]),l("div",null,[t[33]||(t[33]=l("label",{class:"label"},"Köpt datum",-1)),u(l("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>a(n).buy_date=s),type:"date",class:"input"},null,512),[[p,a(n).buy_date]])]),l("div",null,[t[34]||(t[34]=l("label",{class:"label"},"Sålt datum",-1)),u(l("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>a(n).sell_date=s),type:"date",class:"input"},null,512),[[p,a(n).sell_date]])])]),l("div",xl,[l("button",{type:"button",onClick:D,class:"btn btn-secondary"}," Avbryt "),l("button",Cl,o(a(b)?"Spara":"Lägg till"),1)])],32)])])):G("",!0)]))}});export{Ll as default};
