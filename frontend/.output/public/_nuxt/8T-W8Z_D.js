import{e as U,g as q,j as W,k as G,i as J,l as N,m as Q,n as M,p as X,q as Y,r as Z,s as T,v as K,x as tt,y as w,z as et,A as at,B as R,C as st,D as nt,o as g,c as y,a as b,t as v,F as S,E as j,d as k,G as E,H as A,I as rt}from"./BEFdwPCg.js";const ot={trailing:!0};function it(t,e=25,u={}){if(u={...ot,...u},!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let c,n,D=[],r,s;const m=(d,h)=>(r=ct(t,d,h),r.finally(()=>{if(r=null,u.trailing&&s&&!n){const l=m(d,s);return s=null,l}}),r),P=function(...d){return u.trailing&&(s=d),r||new Promise(h=>{const l=!n&&u.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const o=u.leading?c:m(this,d);s=null;for(const a of D)a(o);D=[]},e),l?(c=m(this,d),h(c)):D.push(h)})},i=d=>{d&&(clearTimeout(d),n=null)};return P.isPending=()=>!!n,P.cancel=()=>{i(n),D=[],s=null},P.flush=()=>{if(i(n),!s||r)return;const d=s;return s=null,m(this,d)},P}async function ct(t,e,u){return await t.apply(e,u)}const lt=Symbol.for("nuxt:client-only");function ut(...t){const e=typeof t[t.length-1]=="string"?t.pop():void 0;dt(t[0],t[1])&&t.unshift(e);let[u,c,n={}]=t,D=!1;const r=M(()=>at(u));if(typeof r.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof c!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const s=U();n.server??=!0,n.default??=_t,n.getCachedData??=$,n.lazy??=!1,n.immediate??=!0,n.deep??=q.deep,n.dedupe??="cancel",n._functionName,s._asyncData[r.value];function m(){const o={cause:"initial",dedupe:n.dedupe};return s._asyncData[r.value]?._init||(o.cachedData=n.getCachedData(r.value,s,{cause:"initial"}),s._asyncData[r.value]=I(s,r.value,c,n,o.cachedData)),()=>s._asyncData[r.value].execute(o)}const P=m(),i=s._asyncData[r.value];i._deps++;const d=n.server!==!1&&s.payload.serverRendered;{let o=function(_){const f=s._asyncData[_];f?._deps&&(f._deps--,f._deps===0&&f?._off())};const a=X();if(a&&d&&n.immediate&&!a.sp&&(a.sp=[]),a&&!a._nuxtOnBeforeMountCbs){a._nuxtOnBeforeMountCbs=[];const _=a._nuxtOnBeforeMountCbs;W(()=>{_.forEach(f=>{f()}),_.splice(0,_.length)}),G(()=>_.splice(0,_.length))}const p=a&&(a._nuxtClientOnly||J(lt,!1));d&&s.isHydrating&&(i.error.value||i.data.value!==void 0)?i.status.value=i.error.value?"error":"success":a&&(!p&&s.payload.serverRendered&&s.isHydrating||n.lazy)&&n.immediate?a._nuxtOnBeforeMountCbs.push(P):n.immediate&&i.status.value!=="success"&&P();const x=Y(),C=N(r,(_,f)=>{if((_||f)&&_!==f){D=!0;const B=s._asyncData[f]?.data.value!==void 0,z=s._asyncDataPromises[f]!==void 0,F={cause:"initial",dedupe:n.dedupe};if(!s._asyncData[_]?._init){let O;f&&B?O=s._asyncData[f].data.value:(O=n.getCachedData(_,s,{cause:"initial"}),F.cachedData=O),s._asyncData[_]=I(s,_,c,n,O)}s._asyncData[_]._deps++,f&&o(f),(n.immediate||B||z)&&s._asyncData[_].execute(F),R(()=>{D=!1})}},{flush:"sync"}),L=n.watch?N(n.watch,()=>{D||(s._asyncData[r.value]?._execute.isPending()&&R(()=>{s._asyncData[r.value]?._execute.flush()}),s._asyncData[r.value]?._execute({cause:"watch",dedupe:n.dedupe}))}):()=>{};x&&Q(()=>{C(),L(),o(r.value)})}const h={data:V(()=>s._asyncData[r.value]?.data),pending:V(()=>s._asyncData[r.value]?.pending),status:V(()=>s._asyncData[r.value]?.status),error:V(()=>s._asyncData[r.value]?.error),refresh:(...o)=>s._asyncData[r.value]?._init?s._asyncData[r.value].execute(...o):m()(),execute:(...o)=>h.refresh(...o),clear:()=>{const o=s._asyncData[r.value];if(o?._abortController)try{o._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{o._abortController=void 0}H(s,r.value)}},l=Promise.resolve(s._asyncDataPromises[r.value]).then(()=>h);return Object.assign(l,h),l}function V(t){return M({get(){return t()?.value},set(e){const u=t();u&&(u.value=e)}})}function dt(t,e){return!(typeof t=="string"||typeof t=="object"&&t!==null||typeof t=="function"&&typeof e=="function")}function H(t,e){e in t.payload.data&&(t.payload.data[e]=void 0),e in t.payload._errors&&(t.payload._errors[e]=void 0),t._asyncData[e]&&(t._asyncData[e].data.value=w(t._asyncData[e]._default()),t._asyncData[e].error.value=void 0,t._asyncData[e].status.value="idle"),e in t._asyncDataPromises&&(t._asyncDataPromises[e]=void 0)}function ft(t,e){const u={};for(const c of e)u[c]=t[c];return u}function I(t,e,u,c,n){t.payload._errors[e]??=void 0;const D=c.getCachedData!==$,r=u,s=c.deep?Z:T,m=n!==void 0,P=t.hook("app:data:refresh",async d=>{(!d||d.includes(e))&&await i.execute({cause:"refresh:hook"})}),i={data:s(m?n:c.default()),pending:M(()=>i.status.value==="pending"),error:et(t.payload._errors,e),status:T("idle"),execute:(...d)=>{const[h,l=void 0]=d,o=h&&l===void 0&&typeof h=="object"?h:{};if(t._asyncDataPromises[e]&&(o.dedupe??c.dedupe)==="defer")return t._asyncDataPromises[e];{const x="cachedData"in o?o.cachedData:c.getCachedData(e,t,{cause:o.cause??"refresh:manual"});if(x!==void 0)return t.payload.data[e]=i.data.value=x,i.error.value=void 0,i.status.value="success",Promise.resolve(x)}i._abortController&&i._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),i._abortController=new AbortController,i.status.value="pending";const a=new AbortController,p=new Promise((x,C)=>{try{const L=o.timeout??c.timeout,_=gt([i._abortController?.signal,o?.signal],a.signal,L);if(_.aborted){const f=_.reason;C(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"));return}return _.addEventListener("abort",()=>{const f=_.reason;C(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"))},{once:!0,signal:a.signal}),Promise.resolve(r(t,{signal:_})).then(x,C)}catch(L){C(L)}}).then(async x=>{let C=x;c.transform&&(C=await c.transform(x)),c.pick&&(C=ft(C,c.pick)),t.payload.data[e]=C,i.data.value=C,i.error.value=void 0,i.status.value="success"}).catch(x=>{if(t._asyncDataPromises[e]&&t._asyncDataPromises[e]!==p||i._abortController?.signal.aborted)return t._asyncDataPromises[e];if(typeof DOMException<"u"&&x instanceof DOMException&&x.name==="AbortError")return i.status.value="idle",t._asyncDataPromises[e];i.error.value=tt(x),i.data.value=w(c.default()),i.status.value="error"}).finally(()=>{a.abort(),delete t._asyncDataPromises[e]});return t._asyncDataPromises[e]=p,t._asyncDataPromises[e]},_execute:it((...d)=>i.execute(...d),0,{leading:!0}),_default:c.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{P(),t._asyncData[e]?._init&&(t._asyncData[e]._init=!1),D||K(()=>{t._asyncData[e]?._init||(H(t,e),i.execute=()=>Promise.resolve())})}};return i}const _t=()=>{},$=(t,e,u)=>{if(e.isHydrating)return e.payload.data[t];if(u.cause!=="refresh:manual"&&u.cause!=="refresh:hook")return e.static.data[t]};function gt(t,e,u){const c=t.filter(r=>!!r);if(typeof u=="number"&&u>=0){const r=AbortSignal.timeout?.(u);r&&c.push(r)}if(AbortSignal.any)return AbortSignal.any(c);const n=new AbortController;for(const r of c)if(r.aborted){const s=r.reason??new DOMException("Aborted","AbortError");try{n.abort(s)}catch{n.abort()}return n.signal}const D=()=>{const s=c.find(m=>m.aborted)?.reason??new DOMException("Aborted","AbortError");try{n.abort(s)}catch{n.abort()}};for(const r of c)r.addEventListener?.("abort",D,{once:!0,signal:e});return n.signal}const yt={key:0,class:"text-center py-12 text-red-400"},vt={key:1,class:"text-center py-12 text-slate-500"},ht={class:"grid grid-cols-1 gap-4"},bt={class:"p-4"},Dt={key:0,class:"flex justify-between items-start mb-2"},mt={key:0,class:"font-medium text-slate-100"},pt={key:1,class:"font-medium text-slate-100"},xt={key:2,class:"text-slate-500"},Pt={class:"text-sm text-slate-400"},Ct={class:"text-lg font-bold text-primary-500"},wt={class:"text-sm text-slate-400"},Et={class:"text-sm text-slate-400"},Lt={class:"text-sm text-slate-400"},St={key:3,class:"mt-1"},Ot={class:"flex flex-wrap gap-2"},kt={key:0,class:"text-slate-400 ml-2"},Vt={key:5,class:"text-sm text-slate-500"},Mt={key:1,class:"text-sm text-slate-400 mb-2"},Bt={key:2,class:"flex justify-between items-center text-sm text-slate-400"},Ft=["href"],Nt={key:0,class:"text-center py-12 text-slate-500"},Rt=st({__name:"ads",async setup(t){let e,u;const c=rt(),{data:n,error:D,pending:r}=([e,u]=nt(async()=>ut("ads-listings",async()=>{try{const l=await fetch(`${c.public.apiBase}/api/listings`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const o=await l.json();if(!o||!Array.isArray(o))throw new Error("Invalid response from API");return o.filter(a=>a.Listing&&!a.Listing.is_my_listing)}catch(l){throw console.error("Failed to fetch listings:",l),new Error(l.message||"Kunde inte hämta annonser")}})),e=await e,u(),e),s=l=>l?`${l.toLocaleString("sv-SE")} kr`:"-",m=l=>l?`${l.toLocaleString("sv-SE")} kr`:"-",P=l=>l?`${l.toLocaleString("sv-SE")} kr`:"-",i=l=>{const o={draft:"badge badge-warning",active:"badge badge-success",sold:"badge badge-info",archived:"badge"};return o[l]||o.draft},d=l=>l?"Blocket":"Unknown",h=M(()=>D.value?.message||null);return(l,o)=>(g(),y("div",null,[o[2]||(o[2]=b("div",{class:"flex justify-between items-center mb-6"},[b("h1",{class:"page-header"},"Hittade annonser")],-1)),w(h)?(g(),y("div",yt,v(w(h)),1)):w(r)?(g(),y("div",vt," Laddar... ")):(g(),y(S,{key:2},[b("div",ht,[(g(!0),y(S,null,j(w(n),a=>(g(),y("div",{key:a.Listing?.id,class:"card overflow-hidden"},[b("div",bt,[a.Listing?(g(),y("div",Dt,[b("div",null,[a.Listing.title?(g(),y("p",mt,v(a.Listing.title),1)):a.Product?(g(),y("p",pt,v(a.Product.brand)+" - "+v(a.Product.name),1)):(g(),y("p",xt,"Okänd produkt")),b("p",Pt,[o[0]||(o[0]=k(" Produkt: ",-1)),a.Product?(g(),y(S,{key:0},[k(v(a.Product.brand)+" - "+v(a.Product.name),1)],64)):(g(),y(S,{key:1},[k(" Okänd produkt ")],64))]),b("p",Ct,v(a.Listing.price?m(a.Listing.price):"-"),1),b("p",wt," Nypris: "+v(P(a.Valuations?.find(p=>p.valuation_type_id===4)?.valuation)),1),b("p",Et," Frakt: "+v(a.Listing.shipping_cost!==null&&a.Listing.shipping_cost!==void 0?s(a.Listing.shipping_cost):"Okänt"),1),b("p",Lt," Värdering: "+v(a.Listing.valuation?P(a.Listing.valuation):"-"),1),a.Valuations&&a.Valuations.filter(p=>p.valuation_type_id!==4).length>0?(g(),y("div",St,[o[1]||(o[1]=b("p",{class:"text-xs text-slate-500 mb-1"},"Delvärderingar:",-1)),b("div",Ot,[(g(!0),y(S,null,j(a.Valuations.filter(p=>p.valuation_type_id!==4),p=>(g(),y("span",{key:p.id,class:"text-xs bg-slate-700 px-2 py-1 rounded"},v(P(p.valuation))+" - "+v(p.valuation_type),1))),128))])])):E("",!0),a.PotentialProfit!==void 0?(g(),y("p",{key:4,class:A(["text-sm font-medium",a.PotentialProfit>0?"text-emerald-400":"text-red-400"])},[k(" Vinst: "+v(m(a.PotentialProfit))+" ",1),a.DiscountPercent!==void 0?(g(),y("span",kt," ("+v(a.DiscountPercent.toFixed(1))+"% rabatt) ",1)):E("",!0)],2)):(g(),y("p",Vt," Ingen värdering tillgänglig "))]),b("span",{class:A(i(a.Listing.status))},v(a.Listing.status),3)])):E("",!0),a.Listing?.description?(g(),y("p",Mt,v(a.Listing.description?.substring(0,100))+"... ",1)):E("",!0),a.Listing?(g(),y("div",Bt,[b("span",null,v(d(a.Listing.marketplace_id)),1),b("a",{href:a.Listing.link,target:"_blank",class:"text-primary-400 hover:text-primary-300"}," Visa ",8,Ft)])):E("",!0)])]))),128))]),w(n)?.length===0?(g(),y("div",Nt," Inga annonser hittades. ")):E("",!0)],64))]))}});export{Rt as default};
