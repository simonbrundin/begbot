import{g as q,j as w,k as W,l as G,i as J,m as R,n as Q,p as F,q as X,r as Y,s as Z,v as B,x as K,y as tt,z as L,A as et,B as at,C as j,D as st,E as nt,o as g,c as y,a as D,t as h,F as O,G as H,d as k,H as E,I,J as rt}from"./DJ5wksKX.js";const ot={trailing:!0};function it(t,e=25,u={}){if(u={...ot,...u},!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let l,n,m=[],r,s;const v=(d,b)=>(r=lt(t,d,b),r.finally(()=>{if(r=null,u.trailing&&s&&!n){const c=v(d,s);return s=null,c}}),r),P=function(...d){return u.trailing&&(s=d),r||new Promise(b=>{const c=!n&&u.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const o=u.leading?l:v(this,d);s=null;for(const a of m)a(o);m=[]},e),c?(l=v(this,d),b(l)):m.push(b)})},i=d=>{d&&(clearTimeout(d),n=null)};return P.isPending=()=>!!n,P.cancel=()=>{i(n),m=[],s=null},P.flush=()=>{if(i(n),!s||r)return;const d=s;return s=null,v(this,d)},P}async function lt(t,e,u){return await t.apply(e,u)}const ct=Symbol.for("nuxt:client-only"),ut=t=>t==="defer"||t===!1;function dt(...t){const e=typeof t[t.length-1]=="string"?t.pop():void 0;ft(t[0],t[1])&&t.unshift(e);let[u,l,n={}]=t,m=!1;const r=F(()=>at(u));if(typeof r.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof l!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const s=q();n.server??=!0,n.default??=gt,n.getCachedData??=z,n.lazy??=!1,n.immediate??=!0,n.deep??=w.deep,n.dedupe??="cancel",n._functionName,s._asyncData[r.value];function v(){const o={cause:"initial",dedupe:n.dedupe};return s._asyncData[r.value]?._init||(o.cachedData=n.getCachedData(r.value,s,{cause:"initial"}),s._asyncData[r.value]=A(s,r.value,l,n,o.cachedData)),()=>s._asyncData[r.value].execute(o)}const P=v(),i=s._asyncData[r.value];i._deps++;const d=n.server!==!1&&s.payload.serverRendered;{let o=function(_){const f=s._asyncData[_];f?._deps&&(f._deps--,f._deps===0&&f?._off())};const a=X();if(a&&d&&n.immediate&&!a.sp&&(a.sp=[]),a&&!a._nuxtOnBeforeMountCbs){a._nuxtOnBeforeMountCbs=[];const _=a._nuxtOnBeforeMountCbs;W(()=>{_.forEach(f=>{f()}),_.splice(0,_.length)}),G(()=>_.splice(0,_.length))}const p=a&&(a._nuxtClientOnly||J(ct,!1));d&&s.isHydrating&&(i.error.value||i.data.value!=null)?(i.pending.value=!1,i.status.value=i.error.value?"error":"success"):a&&(!p&&s.payload.serverRendered&&s.isHydrating||n.lazy)&&n.immediate?a._nuxtOnBeforeMountCbs.push(P):n.immediate&&P();const x=Y(),C=R(r,(_,f)=>{if((_||f)&&_!==f){m=!0;const N=s._asyncData[f]?.data.value!==w.value,U=s._asyncDataPromises[f]!==void 0,T={cause:"initial",dedupe:n.dedupe};if(!s._asyncData[_]?._init){let V;f&&N?V=s._asyncData[f].data.value:(V=n.getCachedData(_,s,{cause:"initial"}),T.cachedData=V),s._asyncData[_]=A(s,_,l,n,V)}s._asyncData[_]._deps++,f&&o(f),(n.immediate||N||U)&&s._asyncData[_].execute(T),j(()=>{m=!1})}},{flush:"sync"}),S=n.watch?R(n.watch,()=>{m||(s._asyncData[r.value]?._execute.isPending()&&j(()=>{s._asyncData[r.value]?._execute.flush()}),s._asyncData[r.value]?._execute({cause:"watch",dedupe:n.dedupe}))}):()=>{};x&&Q(()=>{C(),S(),o(r.value)})}const b={data:M(()=>s._asyncData[r.value]?.data),pending:M(()=>s._asyncData[r.value]?.pending),status:M(()=>s._asyncData[r.value]?.status),error:M(()=>s._asyncData[r.value]?.error),refresh:(...o)=>s._asyncData[r.value]?._init?s._asyncData[r.value].execute(...o):v()(),execute:(...o)=>b.refresh(...o),clear:()=>{const o=s._asyncData[r.value];if(o?._abortController)try{o._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{o._abortController=void 0}$(s,r.value)}},c=Promise.resolve(s._asyncDataPromises[r.value]).then(()=>b);return Object.assign(c,b),c}function M(t){return F({get(){return t()?.value},set(e){const u=t();u&&(u.value=e)}})}function ft(t,e){return!(typeof t=="string"||typeof t=="object"&&t!==null||typeof t=="function"&&typeof e=="function")}function $(t,e){e in t.payload.data&&(t.payload.data[e]=void 0),e in t.payload._errors&&(t.payload._errors[e]=w.errorValue),t._asyncData[e]&&(t._asyncData[e].data.value=void 0,t._asyncData[e].error.value=w.errorValue,t._asyncData[e].pending.value=!1,t._asyncData[e].status.value="idle"),e in t._asyncDataPromises&&(t._asyncDataPromises[e]=void 0)}function _t(t,e){const u={};for(const l of e)u[l]=t[l];return u}function A(t,e,u,l,n){t.payload._errors[e]??=w.errorValue;const m=l.getCachedData!==z,r=u,s=l.deep?Z:B,v=n!=null,P=t.hook("app:data:refresh",async d=>{(!d||d.includes(e))&&await i.execute({cause:"refresh:hook"})}),i={data:s(v?n:l.default()),pending:B(!v),error:et(t.payload._errors,e),status:B("idle"),execute:(...d)=>{const[b,c=void 0]=d,o=b&&c===void 0&&typeof b=="object"?b:{};if(t._asyncDataPromises[e]&&ut(o.dedupe??l.dedupe))return t._asyncDataPromises[e];if(o.cause==="initial"||t.isHydrating){const x="cachedData"in o?o.cachedData:l.getCachedData(e,t,{cause:o.cause??"refresh:manual"});if(x!=null)return t.payload.data[e]=i.data.value=x,i.error.value=w.errorValue,i.status.value="success",Promise.resolve(x)}i.pending.value=!0,i._abortController&&i._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),i._abortController=new AbortController,i.status.value="pending";const a=new AbortController,p=new Promise((x,C)=>{try{const S=o.timeout??l.timeout,_=yt([i._abortController?.signal,o?.signal],a.signal,S);if(_.aborted){const f=_.reason;C(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"));return}return _.addEventListener("abort",()=>{const f=_.reason;C(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"))},{once:!0,signal:a.signal}),Promise.resolve(r(t,{signal:_})).then(x,C)}catch(S){C(S)}}).then(async x=>{let C=x;l.transform&&(C=await l.transform(x)),l.pick&&(C=_t(C,l.pick)),t.payload.data[e]=C,i.data.value=C,i.error.value=w.errorValue,i.status.value="success"}).catch(x=>{if(t._asyncDataPromises[e]&&t._asyncDataPromises[e]!==p||i._abortController?.signal.aborted)return t._asyncDataPromises[e];if(typeof DOMException<"u"&&x instanceof DOMException&&x.name==="AbortError")return i.status.value="idle",t._asyncDataPromises[e];i.error.value=tt(x),i.data.value=L(l.default()),i.status.value="error"}).finally(()=>{i.pending.value=!1,a.abort(),delete t._asyncDataPromises[e]});return t._asyncDataPromises[e]=p,t._asyncDataPromises[e]},_execute:it((...d)=>i.execute(...d),0,{leading:!0}),_default:l.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{P(),t._asyncData[e]?._init&&(t._asyncData[e]._init=!1),m||K(()=>{t._asyncData[e]?._init||($(t,e),i.execute=()=>Promise.resolve(),i.data.value=w.value)})}};return i}const gt=()=>w.value,z=(t,e,u)=>{if(e.isHydrating)return e.payload.data[t];if(u.cause!=="refresh:manual"&&u.cause!=="refresh:hook")return e.static.data[t]};function yt(t,e,u){const l=t.filter(r=>!!r);if(typeof u=="number"&&u>=0){const r=AbortSignal.timeout?.(u);r&&l.push(r)}if(AbortSignal.any)return AbortSignal.any(l);const n=new AbortController;for(const r of l)if(r.aborted){const s=r.reason??new DOMException("Aborted","AbortError");try{n.abort(s)}catch{n.abort()}return n.signal}const m=()=>{const s=l.find(v=>v.aborted)?.reason??new DOMException("Aborted","AbortError");try{n.abort(s)}catch{n.abort()}};for(const r of l)r.addEventListener?.("abort",m,{once:!0,signal:e});return n.signal}const ht={key:0,class:"text-center py-12 text-red-400"},vt={key:1,class:"text-center py-12 text-slate-500"},bt={class:"grid grid-cols-1 gap-4"},Dt={class:"p-4"},mt={key:0,class:"flex justify-between items-start mb-2"},pt={key:0,class:"font-medium text-slate-100"},xt={key:1,class:"font-medium text-slate-100"},Pt={key:2,class:"text-slate-500"},Ct={class:"text-sm text-slate-400"},wt={class:"text-lg font-bold text-primary-500"},Et={class:"text-sm text-slate-400"},Lt={class:"text-sm text-slate-400"},St={class:"text-sm text-slate-400"},Ot={key:3,class:"mt-1"},Vt={class:"flex flex-wrap gap-2"},kt={key:0,class:"text-slate-400 ml-2"},Mt={key:5,class:"text-sm text-slate-500"},Bt={key:1,class:"text-sm text-slate-400 mb-2"},Ft={key:2,class:"flex justify-between items-center text-sm text-slate-400"},Nt=["href"],Tt={key:0,class:"text-center py-12 text-slate-500"},jt=st({__name:"ads",async setup(t){let e,u;const l=rt(),{data:n,error:m,pending:r}=([e,u]=nt(async()=>dt("ads-listings",async()=>{try{const c=await fetch(`${l.public.apiBase}/api/listings`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const o=await c.json();if(!o||!Array.isArray(o))throw new Error("Invalid response from API");return o.filter(a=>a.Listing&&!a.Listing.is_my_listing)}catch(c){throw console.error("Failed to fetch listings:",c),new Error(c.message||"Kunde inte hämta annonser")}})),e=await e,u(),e),s=c=>c?`${c.toLocaleString("sv-SE")} kr`:"-",v=c=>c?`${c.toLocaleString("sv-SE")} kr`:"-",P=c=>c?`${c.toLocaleString("sv-SE")} kr`:"-",i=c=>{const o={draft:"badge badge-warning",active:"badge badge-success",sold:"badge badge-info",archived:"badge"};return o[c]||o.draft},d=c=>c?"Blocket":"Unknown",b=F(()=>m.value?.message||null);return(c,o)=>(g(),y("div",null,[o[2]||(o[2]=D("div",{class:"flex justify-between items-center mb-6"},[D("h1",{class:"page-header"},"Hittade annonser")],-1)),L(b)?(g(),y("div",ht,h(L(b)),1)):L(r)?(g(),y("div",vt," Laddar... ")):(g(),y(O,{key:2},[D("div",bt,[(g(!0),y(O,null,H(L(n),a=>(g(),y("div",{key:a.Listing?.id,class:"card overflow-hidden"},[D("div",Dt,[a.Listing?(g(),y("div",mt,[D("div",null,[a.Listing.title?(g(),y("p",pt,h(a.Listing.title),1)):a.Product?(g(),y("p",xt,h(a.Product.brand)+" - "+h(a.Product.name),1)):(g(),y("p",Pt,"Okänd produkt")),D("p",Ct,[o[0]||(o[0]=k(" Produkt: ",-1)),a.Product?(g(),y(O,{key:0},[k(h(a.Product.brand)+" - "+h(a.Product.name),1)],64)):(g(),y(O,{key:1},[k(" Okänd produkt ")],64))]),D("p",wt,h(a.Listing.price?v(a.Listing.price):"-"),1),D("p",Et," Nypris: "+h(P(a.Valuations?.find(p=>p.valuation_type_id===4)?.valuation)),1),D("p",Lt," Frakt: "+h(a.Listing.shipping_cost!==null&&a.Listing.shipping_cost!==void 0?s(a.Listing.shipping_cost):"Okänt"),1),D("p",St," Värdering: "+h(a.Listing.valuation?P(a.Listing.valuation):"-"),1),a.Valuations&&a.Valuations.filter(p=>p.valuation_type_id!==4).length>0?(g(),y("div",Ot,[o[1]||(o[1]=D("p",{class:"text-xs text-slate-500 mb-1"},"Delvärderingar:",-1)),D("div",Vt,[(g(!0),y(O,null,H(a.Valuations.filter(p=>p.valuation_type_id!==4),p=>(g(),y("span",{key:p.id,class:"text-xs bg-slate-700 px-2 py-1 rounded"},h(P(p.valuation))+" - "+h(p.valuation_type),1))),128))])])):E("",!0),a.PotentialProfit!==void 0?(g(),y("p",{key:4,class:I(["text-sm font-medium",a.PotentialProfit>0?"text-emerald-400":"text-red-400"])},[k(" Vinst: "+h(v(a.PotentialProfit))+" ",1),a.DiscountPercent!==void 0?(g(),y("span",kt," ("+h(a.DiscountPercent.toFixed(1))+"% rabatt) ",1)):E("",!0)],2)):(g(),y("p",Mt," Ingen värdering tillgänglig "))]),D("span",{class:I(i(a.Listing.status))},h(a.Listing.status),3)])):E("",!0),a.Listing?.description?(g(),y("p",Bt,h(a.Listing.description?.substring(0,100))+"... ",1)):E("",!0),a.Listing?(g(),y("div",Ft,[D("span",null,h(d(a.Listing.marketplace_id)),1),D("a",{href:a.Listing.link,target:"_blank",class:"text-primary-400 hover:text-primary-300"}," Visa ",8,Nt)])):E("",!0)])]))),128))]),L(n)?.length===0?(g(),y("div",Tt," Inga annonser hittades. ")):E("",!0)],64))]))}});export{jt as default};
