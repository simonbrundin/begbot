import{C as B,J as E,c as n,a as s,y as U,t as i,G as p,F as q,E as O,O as h,K as w,N as C,r as d,n as k,V as H,o,U as J,H as F,_ as P}from"./BEFdwPCg.js";import{u as Q}from"./DPGkDMz_.js";import"./BMadXahP.js";const W={class:"mb-6"},X={key:0,class:"text-slate-400 mt-2"},Y={key:0,class:"text-center py-12 text-slate-500"},Z={key:1,class:"space-y-6"},ee={class:"card p-6"},te={key:0,class:"text-center py-8 text-slate-500"},se={key:1,class:"space-y-4"},ae={class:"flex justify-between items-start mb-2"},ne={class:"font-medium"},oe={class:"flex items-center gap-2"},le={class:"text-xs text-slate-500"},re={class:"text-slate-200"},ie={key:0,class:"mt-4 flex gap-2"},de=["onClick"],ce=["onClick"],ue=["onClick"],ge={class:"flex gap-4"},ve=["disabled"],pe=["disabled"],me={key:2,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},be={class:"bg-slate-800 rounded-lg p-6 w-full max-w-2xl border border-slate-700"},ye={class:"mb-4"},xe={class:"flex justify-end gap-2"},fe={key:3,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},ke={class:"bg-slate-800 rounded-lg p-6 w-full max-w-2xl border border-slate-700"},_e={class:"mb-4"},he={class:"flex justify-end gap-2"},we=B({__name:"[id]",setup(Ce){const M=H(),l=Q(),m=k(()=>parseInt(M.params.id)),g=d(null),c=d([]),f=d(!0),r=d(!1),v=d(null),b=d(!1),y=d({content:""}),x=d({content:""}),$=k(()=>c.value[c.value.length-1]?.direction==="incoming"&&!j.value),j=k(()=>c.value.some(t=>t.direction==="outgoing"&&t.status==="pending")),G=async()=>{try{g.value=await l.get(`/conversations/${m.value}`)}catch(t){console.error("Failed to fetch conversation:",t)}},u=async()=>{f.value=!0;try{c.value=await l.get(`/conversations/${m.value}/messages`)}catch(t){console.error("Failed to fetch messages:",t)}finally{f.value=!1}},I=async()=>{if(g.value){r.value=!0;try{await l.post("/messages",{listing_id:g.value.listing_id,message_type:"initial"}),await u()}catch(t){console.error("Failed to generate message:",t),alert("Kunde inte generera meddelande. Försök igen.")}finally{r.value=!1}}},K=async()=>{r.value=!0;try{await l.post("/messages",{conversation_id:m.value,message_type:"reply"}),await u()}catch(t){console.error("Failed to generate reply:",t),alert("Kunde inte generera svar. Försök igen.")}finally{r.value=!1}},S=async t=>{try{await l.put(`/messages/${t}/approve`,{}),await u()}catch(e){console.error("Failed to approve message:",e),alert("Kunde inte godkänna meddelande. Försök igen.")}},D=async t=>{if(confirm("Är du säker på att du vill neka detta meddelande?"))try{await l.put(`/messages/${t}/reject`,{}),await u()}catch(e){console.error("Failed to reject message:",e),alert("Kunde inte neka meddelande. Försök igen.")}},L=t=>{v.value=t,y.value.content=t.content},T=async()=>{if(v.value)try{await l.put(`/messages/${v.value.id}`,{content:y.value.content}),v.value=null,await u()}catch(t){console.error("Failed to update message:",t),alert("Kunde inte uppdatera meddelande. Försök igen.")}},V=async()=>{try{await l.post("/messages",{conversation_id:m.value,message_type:"incoming",content:x.value.content}),x.value.content="",b.value=!1,await u()}catch(t){console.error("Failed to add incoming message:",t),alert("Kunde inte lägga till meddelande. Försök igen.")}},N=t=>{const e="p-4 rounded-lg border";return t.direction==="outgoing"?`${e} bg-primary-900/20 border-primary-700`:`${e} bg-slate-700/50 border-slate-600`},R=t=>({pending:"px-2 py-1 bg-yellow-500/20 text-yellow-400 text-xs rounded",approved:"px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded",sent:"px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded",rejected:"px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded",received:"px-2 py-1 bg-slate-500/20 text-slate-400 text-xs rounded"})[t]||"px-2 py-1 bg-slate-500/20 text-slate-400 text-xs rounded",A=t=>({pending:"Väntar på granskning",approved:"Godkänd",sent:"Skickad",rejected:"Nekad",received:"Mottagen"})[t]||t,z=t=>{const e=new Date(t);return new Intl.DateTimeFormat("sv-SE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)};return E(async()=>{await G(),await u()}),(t,e)=>(o(),n("div",null,[s("div",W,[s("button",{onClick:e[0]||(e[0]=a=>("navigateTo"in t?t.navigateTo:U(J))("/conversations")),class:"text-primary-400 hover:text-primary-300 mb-4"}," ← Tillbaka till konversationer "),e[6]||(e[6]=s("h1",{class:"page-header"},"Konversation",-1)),g.value?(o(),n("p",X,i(g.value.listing_title)+" - "+i(g.value.marketplace_name),1)):p("",!0)]),f.value?(o(),n("div",Y," Laddar meddelanden... ")):(o(),n("div",Z,[s("div",ee,[e[7]||(e[7]=s("h2",{class:"text-xl font-semibold text-slate-100 mb-4"},"Meddelandehistorik",-1)),c.value.length===0?(o(),n("div",te," Inga meddelanden än ")):(o(),n("div",se,[(o(!0),n(q,null,O(c.value,a=>(o(),n("div",{key:a.id,class:F(N(a))},[s("div",ae,[s("span",ne,i(a.direction==="outgoing"?"Du":"Säljare"),1),s("div",oe,[s("span",{class:F(R(a.status))},i(A(a.status)),3),s("span",le,i(z(a.created_at)),1)])]),s("p",re,i(a.content),1),a.status==="pending"&&a.direction==="outgoing"?(o(),n("div",ie,[s("button",{onClick:_=>L(a),class:"btn btn-secondary text-sm"}," Redigera ",8,de),s("button",{onClick:_=>S(a.id),class:"btn btn-primary text-sm"}," Godkänn och skicka ",8,ce),s("button",{onClick:_=>D(a.id),class:"btn btn-danger text-sm"}," Neka ",8,ue)])):p("",!0)],2))),128))]))]),s("div",ge,[c.value.length===0?(o(),n("button",{key:0,onClick:I,class:"btn btn-primary",disabled:r.value},i(r.value?"Genererar...":"Generera första meddelande"),9,ve)):$.value?(o(),n("button",{key:1,onClick:K,class:"btn btn-primary",disabled:r.value},i(r.value?"Genererar...":"Generera svar"),9,pe)):p("",!0),s("button",{onClick:e[1]||(e[1]=a=>b.value=!0),class:"btn btn-secondary"}," Lägg till inkommande meddelande ")])])),v.value?(o(),n("div",me,[s("div",be,[e[10]||(e[10]=s("h2",{class:"text-xl font-bold text-slate-100 mb-4"},"Redigera meddelande",-1)),s("form",{onSubmit:h(T,["prevent"])},[s("div",ye,[e[8]||(e[8]=s("label",{class:"label"},"Meddelande",-1)),w(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.value.content=a),class:"input h-32",required:""},null,512),[[C,y.value.content]])]),s("div",xe,[s("button",{type:"button",onClick:e[3]||(e[3]=a=>v.value=null),class:"btn btn-secondary"}," Avbryt "),e[9]||(e[9]=s("button",{type:"submit",class:"btn btn-primary"}," Spara ",-1))])],32)])])):p("",!0),b.value?(o(),n("div",fe,[s("div",ke,[e[13]||(e[13]=s("h2",{class:"text-xl font-bold text-slate-100 mb-4"},"Lägg till inkommande meddelande",-1)),s("form",{onSubmit:h(V,["prevent"])},[s("div",_e,[e[11]||(e[11]=s("label",{class:"label"},"Meddelande från säljare",-1)),w(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>x.value.content=a),class:"input h-32",required:""},null,512),[[C,x.value.content]])]),s("div",he,[s("button",{type:"button",onClick:e[5]||(e[5]=a=>b.value=!1),class:"btn btn-secondary"}," Avbryt "),e[12]||(e[12]=s("button",{type:"submit",class:"btn btn-primary"}," Lägg till ",-1))])],32)])])):p("",!0)]))}}),je=P(we,[["__scopeId","data-v-a19735fe"]]);export{je as default};
