import{D as P,K as R,c as o,a as s,F as m,G as v,z as l,H as y,t as r,P as T,L as p,M as x,O as w,s as u,o as i,I as A}from"./DJ5wksKX.js";import{L as B}from"./CGQrFPvo.js";import{u as D}from"./dQMjavNy.js";import"./DU5dWS6F.js";const O={class:"flex justify-between items-center mb-6"},z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},I={class:"p-4"},E={class:"flex justify-between items-start mb-2"},G={key:0,class:"font-medium text-slate-100"},H={key:1,class:"text-slate-500"},K={class:"text-lg font-bold text-primary-500"},q={key:2,class:"text-sm text-slate-400"},J={class:"text-sm text-slate-400 mb-2"},Q={class:"flex justify-between items-center text-sm text-slate-400"},W=["href"],X={class:"px-4 py-3 bg-slate-800/50 border-t border-slate-700 flex justify-end gap-2"},Y=["onClick"],Z=["onClick"],tt={key:0,class:"text-center py-12 text-slate-500"},et={key:1,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50"},st={class:"bg-slate-800 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-slate-700"},at={class:"text-xl font-bold text-slate-100 mb-4"},lt={class:"grid grid-cols-2 gap-4"},nt=["value"],ot=["value"],it=["value"],rt={class:"col-span-2"},dt={class:"col-span-2"},ut={class:"flex justify-end gap-2 pt-4"},ct={type:"submit",class:"btn btn-primary"},kt=P({__name:"listings",setup(pt){const c=D(),b=u([]),f=u([]),k=u([]),h=u(!1),_=u(!1),d=u(null),L={product_id:null,price:null,link:"",description:"",marketplace_id:null,status:"draft",is_my_listing:!0},n=u({...L}),g=async()=>{h.value=!0;try{const[a,t,e]=await Promise.all([c.get("/listings?mine=true"),c.get("/products"),c.get("/marketplaces")]);b.value=a,f.value=t,k.value=e}catch(a){console.error("Failed to fetch data:",a)}finally{h.value=!1}},V=a=>`${(a/100).toFixed(2)} kr`,M=a=>{const t={draft:"badge badge-warning",active:"badge badge-success",sold:"badge badge-info",archived:"badge"};return t[a]||t.draft},S=a=>a&&k.value.find(t=>t.id===a)?.name||"Unknown",U=a=>{if(!a)return"Okänd produkt";const t=f.value.find(e=>e.id===a);return t?`${t.brand} ${t.name}`:"Okänd produkt"},j=a=>{d.value=a,n.value={product_id:a.product_id,price:a.price,link:a.link,description:a.description,marketplace_id:a.marketplace_id,status:a.status,is_my_listing:!0}},C=()=>{_.value=!1,d.value=null,n.value={...L}},$=async()=>{try{d.value?await c.put(`/listings/${d.value.id}`,n.value):await c.post("/listings",n.value),C(),await g()}catch(a){console.error("Failed to save listing:",a)}},F=async a=>{if(confirm("Är du säker på att du vill ta bort denna annons?"))try{await c.delete(`/listings/${a}`),await g()}catch(t){console.error("Failed to delete listing:",t)}};return R(g),(a,t)=>(i(),o("div",null,[s("div",O,[t[7]||(t[7]=s("h1",{class:"page-header"},"Mina annonser",-1)),s("button",{onClick:t[0]||(t[0]=e=>_.value=!0),class:"btn btn-primary"}," Lägg till annons ")]),s("div",z,[(i(!0),o(m,null,v(l(b),e=>(i(),o("div",{key:e.id,class:"card overflow-hidden"},[s("div",I,[s("div",E,[s("div",null,[e.product_id?(i(),o("p",G,r(U(e.product_id)),1)):(i(),o("p",H,"Okänd produkt")),s("p",K,r(e.price?V(e.price):"-"),1),e.valuation?(i(),o("p",q," Värdering: "+r(V(e.valuation)),1)):y("",!0)]),s("span",{class:A(M(e.status))},r(e.status),3)]),s("p",J,r(e.description?.substring(0,100))+"... ",1),s("div",Q,[s("span",null,r(S(e.marketplace_id)),1),s("a",{href:e.link,target:"_blank",class:"text-primary-400 hover:text-primary-300"}," Visa ",8,W)])]),s("div",X,[s("button",{onClick:N=>j(e),class:"text-sm text-primary-400 hover:text-primary-300"}," Redigera ",8,Y),s("button",{onClick:N=>F(e.id),class:"text-sm text-red-400 hover:text-red-300"}," Ta bort ",8,Z)])]))),128))]),l(b).length===0?(i(),o("div",tt," Inga annonser hittades. Lägg till din första annons! ")):y("",!0),l(_)||l(d)?(i(),o("div",et,[s("div",st,[s("h2",at,r(l(d)?"Redigera annons":"Lägg till ny annons"),1),s("form",{onSubmit:T($,["prevent"]),class:"space-y-4"},[s("div",lt,[s("div",null,[t[9]||(t[9]=s("label",{class:"label"},"Produkt",-1)),p(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>l(n).product_id=e),class:"input"},[t[8]||(t[8]=s("option",{value:""},"Välj produkt...",-1)),(i(!0),o(m,null,v(l(f),e=>(i(),o("option",{key:e.id,value:e.id},r(e.brand)+" "+r(e.name),9,nt))),128))],512),[[x,l(n).product_id]])]),s("div",null,[t[10]||(t[10]=s("label",{class:"label"},"Pris (öre)",-1)),p(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>l(n).price=e),type:"number",class:"input"},null,512),[[w,l(n).price,void 0,{number:!0}]])]),s("div",null,[t[11]||(t[11]=s("label",{class:"label"},"Status",-1)),p(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l(n).status=e),class:"input"},[(i(!0),o(m,null,v(l(B),e=>(i(),o("option",{key:e,value:e},r(e),9,ot))),128))],512),[[x,l(n).status]])]),s("div",null,[t[13]||(t[13]=s("label",{class:"label"},"Marknadsplats",-1)),p(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>l(n).marketplace_id=e),class:"input"},[t[12]||(t[12]=s("option",{value:""},"Välj marknadsplats...",-1)),(i(!0),o(m,null,v(l(k),e=>(i(),o("option",{key:e.id,value:e.id},r(e.name),9,it))),128))],512),[[x,l(n).marketplace_id]])]),s("div",rt,[t[14]||(t[14]=s("label",{class:"label"},"Länk",-1)),p(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>l(n).link=e),type:"text",class:"input"},null,512),[[w,l(n).link]])]),s("div",dt,[t[15]||(t[15]=s("label",{class:"label"},"Beskrivning",-1)),p(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>l(n).description=e),class:"input",rows:"3"},null,512),[[w,l(n).description]])])]),s("div",ut,[s("button",{type:"button",onClick:C,class:"btn btn-secondary"}," Avbryt "),s("button",ct,r(l(d)?"Spara":"Lägg till"),1)])],32)])])):y("",!0)]))}});export{kt as default};
